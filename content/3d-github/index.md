---
title: "Используем github в помощь твердотельному моделированию"
date: 2022-07-26T10:15:10+03:00
# weight: 1
# aliases: ["/first"]
categories: ["3D","GitHub"]
tags: ["3d", "hobby", "github", "openscad", "3d-print"]
type: "post"
author: "VLegio"
description: ""
showToc: false
TocOpen: false
draft: false
hidemeta: false
disableShare: false
# cover:
#     image: "<image path/url>"
#     alt: "<alt text>"
#     caption: "<text>"
#     relative: false
comments: false
---

И так, допустим, у вас есть один или несколько 3d принтеров, желание творить и, возможно, но не обязательно небольшая команда. И вот вы начинаете разрабатывать свою модель. 

В качестве ПО для моделирования выбор пал на [OpenSCAD](https://openscad.org/). Почему на него? А всё очень просто - это идеальный инструмент моделирования, для того, кто привык работать с кодом. В OpenSCAD для моделирования используется функциональный C-подобный язык. Есть графические  2D и 3D примитивы и операции над ними, [шпаргалка по ним тут](https://openscad.org/cheatsheet/index.html).

## Достоинства OpenSCAD
* Модель описывается кодом
* Следствие первого - модель получается параметризуемой
* Есть assert'ы
* К нему применимы теже подходы, что при разработке ПО
* В том числе подход CI

## Недостатки OpenSCAD
* Может применяться только для технического моделирования (Нет, вы можете сделать в нем скульптинг, но это будет гораздо сложнее)
* Средне-высокий порог входа
* Не самый шустрый

## Построение CI при ипользовании OpenSCAD

Мало отличается от построения CI при разработке ПО. По факту в раннере github\gitlab\bitbucket (нужное подчеркнуть) нам надо запустить контейнер с OpenSCAD и отправить нашу модель компилироваться.

Однако, в OpenSCAD есть волшебная переменная `$fn` которая влияет на две вещи:
* Грубо говоря на количество секторов в окружности - чем больше, тем более гладкая и красивая модель
* Как следствие - чем больше `$fn` тем больше время компиляции нашего .scad в .stl или рендеринга в изображение

Поэтому, что бы мы могли экономить время работы раннера (а оно лимитированно), мы добавим в начало нашего проекта вот такие строки:
```openscad
q=0;
$fn = (q==0)? 100 : q;
```
Где мы объявляем переменную q равную нулю, и дальше задаем специальной переменной $fn значение либо 100 если q равно нулю (удобно при разработке), либо значение переменной `q`.

Что бы на этапе сборки подставить в q собственное значение нам надо будет добавить к строке компиляции параметр `-D q=500`. Однако, для github нам не критично качество модели, нам важно проверить сборку и срабатывание ассертов. Поэтому значений q зададим как 10. У нас будет абсолютно ужасная модель, но мы её даже не увидим.


С частью OpenSCAD покончено, теперь перейдем к GitHub.

[Экшен](https://github.com/flat35hd99/openscad-actions) включает в себя всё, что нам нужно, специально для вас, хотя кого я обманываю, для себя, я добавил в него поддержку параметров. 

Создаем workflow:
```yaml
name: Render stl                                    
on:                                    
  push:

jobs:                                    
  full:                                    
    runs-on: ubuntu-latest                                    
    steps:                                    
      - name: Setup                                    
        uses: actions/checkout@v2                                    
      - name: Render full image                                    
        uses: flat35hd99/openscad-actions@v1.4                                    
        with:                                    
          scad_file: model.scad                                    
          output_file: model.stl                                    
          options: "-D q=10"
```

И, готово, мы прекрасны. Теперь на каждый пуш у нас будет проверяться на компилируемость. Что значит, что о грубых ошибках и срабатываниях ассертов мы узнаем от CI.

[Пример работы](https://github.com/vlegio/PaintingHandle)

---
Если у тебя есть вопросы, комментарии и/или замечания – заходи в [чат](https://t.me/cursor_legiona_chat), а так же подписывайся на [канал](https://t.me/cursor_legiona).
